<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: uploader.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: uploader.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const async = require('async');
const prompt = require('prompt');
const Utils = require('./src/utils');
const Api = require('./src/api');

const PATH_ARGV_INDEX = 2;
const DESCRIPTION_ARGV_INDEX = 3;
const path = process.argv[PATH_ARGV_INDEX];
const description = process.argv[DESCRIPTION_ARGV_INDEX];

/**
 * Main module that gets executed
 * @module uploader
 */

// Start the prompt
prompt.start();

// Prompt schema
var schema = {
  properties: {
    retry: {
      description: 'retry? (y/n) ',
      default: 'y',
      pattern: /^(?:y|n)$/,
      message: "'You must enter 'y' or 'n'",
      required: true
    },
  }
};

/**
* This function triggers the main execution path way. That beign the asyn's waterfall method
* that chains the steps required to perform the upload.
* It also provides a mechanism to retry the upload if an error ocurs.
* When the process finishes it logs the gist url.
* @param {string} path the path given by the user
* @param {string} description description of the gist
*/
const main = (path, description) => {
  async.waterfall(
    [
      async.constant(path, description),
      Utils.resolvePath,
      Utils.createFilesArray,
      Utils.createPostBody,
      Utils.createPostData
    ],
    (err, result) => {
      if(err) {
        console.log('Something wrong happened: ', err.message);
        // Ask the user for retry
        prompt.get(schema, function (err, result) {
          if (result &amp;&amp; result.retry === 'y') {
            console.log('Retrying...');
            main(path, description);
          }
        });
        return;
      }
      console.log('Gist url: ', result);
    }
  );
}
main(path, description);
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-api.html">api</a></li><li><a href="module-uploader.html">uploader</a></li><li><a href="module-utils.html">utils</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Thu Nov 30 2017 13:04:40 GMT-0300 (UYT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
